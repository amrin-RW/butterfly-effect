/*!
 * Copyright (c) "TheaterJS OY" 2019
 * 
 * Note:
 * We're gradually open-sourcing some components of Theatre as their code matures.
 * In the meantime, this library on npm and other package managers is available
 * free of charge, and can be used in both personal and commercial projects.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Theatre=e():t.Theatre=e()}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=13)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return h}));var i=r(2);class n{constructor(t){this._cb=t=>{this._tappers.forEach(e=>{e(t)})},this._lastTapperId=0,this._untapFromSource=null,this._props=t,this._tappers=new Map}_check(){this._untapFromSource?0===this._tappers.size&&(this._untapFromSource(),this._untapFromSource=null):0!==this._tappers.size&&(this._untapFromSource=this._props.tapToSource(this._cb))}tap(t){const e=this._lastTapperId++;return this._tappers.set(e,t),this._check(),()=>{this._removeTapperById(e)}}_removeTapperById(t){this._tappers.delete(t)}map(t){return new n({tapToSource:e=>this.tap(r=>e(t(r)))})}}class s{constructor(){this._lastTapperId=0,this._tappers=new Map,this.tappable=new n({tapToSource:t=>this._tap(t)})}_tap(t){const e=this._lastTapperId++;return this._tappers.set(e,t),this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size),()=>{this._removeTapperById(e)}}_removeTapperById(t){const e=this._tappers.size;this._tappers.delete(t);e!==this._tappers.size&&this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size)}emit(t){this._tappers.forEach(e=>{e(t)})}hasTappers(){return 0!==this._tappers.size}onNumberOfTappersChange(t){this._onNumberOfTappersChangeListener=t}}class o{constructor(t,e){return this._derivation=t,this._ticker=e,this._emitter=new s,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_youMayNeedToUpdateYourself(){this._ticker.registerComputationUpdate(this)}_reactToNumberOfTappersChange(){const t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation._addDependent(this):this._derivation._removeDependent(this))}tappable(){return this._emitter.tappable}_updateComputation(){const t=this._derivation.getValue();t===this._lastValue&&!0===this._lastValueRecorded||(this._lastValue=t,this._lastValueRecorded=!0,this._emitter.emit(t))}}class a{constructor(t,e=!1){return this.dontEmitValues=e,this._derivation=t,this._emitter=new s,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_youMayNeedToUpdateYourself(){this._emitter.emit(void 0)}_reactToNumberOfTappersChange(){const t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation._addDependent(this):this._derivation._removeDependent(this))}tappable(){return this._emitter.tappable}}class c{constructor(){this.isDerivation=!0,this._didNotifyDownstreamOfUpcomingUpdate=!1,this._id=l++,this._freshnessState=0,this._lastValue=void 0,this._thereAreMoreThanOneDependents=!1,this._dependencies=new Set,this._dependents=new Set}_addDependency(t){this._dependencies.has(t)||(this._dependencies.add(t),this._thereAreMoreThanOneDependents&&t._addDependent(this))}_removeDependency(t){this._dependencies.has(t)&&(this._dependencies.delete(t),this._thereAreMoreThanOneDependents&&t._removeDependent(this))}_removeAllDependencies(){this._dependencies.forEach(t=>{this._removeDependency(t)})}changes(t){return new o(this,t).tappable()}changesWithoutValues(){return new a(this).tappable()}keepHot(){return this.changesWithoutValues().tap(()=>{})}tapImmediate(t,e){const r=this.changes(t).tap(e);return e(this.getValue()),r}_hasDependents(){return 0!==this._dependents.size}_addDependent(t){const e=this._dependents.size>0;this._dependents.add(t);e!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}_removeDependent(t){const e=this._dependents.size>0;this._dependents.delete(t);e!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}_youMayNeedToUpdateYourself(){this._didNotifyDownstreamOfUpcomingUpdate||(this._didNotifyDownstreamOfUpcomingUpdate=!0,this._freshnessState=1,this._hasDependents()&&this._dependents.forEach(t=>{t._youMayNeedToUpdateYourself(this)}))}getValue(){return this._getValue(!1)}_getValue(t){if(Object(i.d)(this),2!==this._freshnessState){const t=this._recalculate();this._lastValue=t,1===this._freshnessState&&(this._freshnessState=2,this._didNotifyDownstreamOfUpcomingUpdate=!1)}return Object(i.c)(this),this._lastValue}getValueCold(){return this._getValue(!0)}_reactToNumberOfDependentsChange(){const t=this._dependents.size>0;t!==this._thereAreMoreThanOneDependents&&(this._thereAreMoreThanOneDependents=t,this._didNotifyDownstreamOfUpcomingUpdate=!1,t?(this._freshnessState=1,this._dependencies.forEach(t=>{t._addDependent(this)}),this._keepUptodate()):(this._freshnessState=0,this._dependencies.forEach(t=>{t._removeDependent(this)}),this._stopKeepingUptodate()))}_keepUptodate(){}_stopKeepingUptodate(){}map(t){return p.default(this,t)}flatMap(t){return d.default(this,t)}flatten(){return this.flattenDeep(1)}flattenDeep(t){return u.default(this,t)}}function h(t){return t&&t.isDerivation&&!0===t.isDerivation}const u=r(14),d=r(15),p=r(16);let l=0},function(t,e,r){"use strict";e.a=()=>{}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"d",(function(){return a})),r.d(e,"c",(function(){return c})),r.d(e,"b",(function(){return h}));var i=r(1);const n=new class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){const t=this._head;if(t)return this._head=t.next,t.data}push(t){const e={next:this._head,data:t};this._head=e}},s=i.a,o=(t,e)=>{n.push(e),t(),n.pop()},a=t=>{const e=n.peek();e&&e(t),n.push(s)},c=t=>{n.pop()},h=()=>n.peek()!==s},,function(t,e,r){"use strict";(function(t,i){var n,s=r(6);n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:i;var o=Object(s.a)(n);e.a=o}).call(this,r(17),r(18)(t))},function(t,e){},function(t,e,r){"use strict";function i(t){var e,r=t.Symbol;return"function"==typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}r.d(e,"a",(function(){return i}))},function(t,e){t.exports=function(){function t(t,e,r,i){this.set(t,e,r,i)}return t.prototype.set=function(t,e,r,i){this._cx=3*t,this._bx=3*(r-t)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*e,this._by=3*(i-e)-this._cy,this._ay=1-this._cy-this._by},t.epsilon=1e-6,t.prototype._sampleCurveX=function(t){return((this._ax*t+this._bx)*t+this._cx)*t},t.prototype._sampleCurveY=function(t){return((this._ay*t+this._by)*t+this._cy)*t},t.prototype._sampleCurveDerivativeX=function(t){return(3*this._ax*t+2*this._bx)*t+this._cx},t.prototype._solveCurveX=function(t,e){var r,i,n,s,o,a;for(n=void 0,s=void 0,o=void 0,a=void 0,r=void 0,i=void 0,o=t,i=0;i<8;){if(a=this._sampleCurveX(o)-t,Math.abs(a)<e)return o;if(r=this._sampleCurveDerivativeX(o),Math.abs(r)<e)break;o-=a/r,i++}if((o=t)<(n=0))return n;if(o>(s=1))return s;for(;n<s;){if(a=this._sampleCurveX(o),Math.abs(a-t)<e)return o;t>a?n=o:s=o,o=.5*(s-n)+n}return o},t.prototype.solve=function(t,e){return this._sampleCurveY(this._solveCurveX(t,e))},t.prototype.solveSimple=function(t){return this._sampleCurveY(this._solveCurveX(t,1e-6))},t}()},function(t,e){},function(t,e){},,,,function(t,e,r){t.exports=r(19)},function(t,e,r){"use strict";r.r(e),r.d(e,"FlattenDeepDerivation",(function(){return n}));var i=r(0);class n extends i.a{constructor(t,e=200){return super(),this._stackOfDependencies=[t],this._maxDepth=e,this._updateNeededFromIndex=0,this._addDependency(t),this}_recalculate(){const t=-1===this._updateNeededFromIndex?0:this._updateNeededFromIndex;this._updateNeededFromIndex=-1;for(let e=this._stackOfDependencies.length-1;e>t;e--){const t=this._stackOfDependencies.pop();this._removeDependency(t)}let e=t;for(;;){const t=e,r=this._stackOfDependencies[e].getValue();if(t===this._maxDepth)return r;if(!(r instanceof i.a))return r;this._stackOfDependencies.push(r),this._addDependency(r),e++}}_youMayNeedToUpdateYourself(t){const e=this._stackOfDependencies.indexOf(t);if(-1===e)throw Error("got a _youMayNeedToUpdateYourself() from a dep that's not in the stack");if(-1===this._updateNeededFromIndex)this._updateNeededFromIndex=e,i.a.prototype._youMayNeedToUpdateYourself.call(this,t);else{if(this._updateNeededFromIndex<=e)return;this._updateNeededFromIndex=e,i.a.prototype._youMayNeedToUpdateYourself.call(this,t)}}_keepUptodate(){this.getValue()}}e.default=function(t,e=7){return new n(t,e)}},function(t,e,r){"use strict";r.r(e),r.d(e,"FlatMapDerivation",(function(){return a})),r.d(e,"default",(function(){return c}));var i=r(0);const n=0,s=1,o=2;class a extends i.a{constructor(t,e){return super(),this._depDerivation=t,this._fn=e,this._innerDerivation=void 0,this._updateNeededFrom=s,this._hot=!1,this._addDependency(t),this}_recalculateHot(){const t=this._updateNeededFrom;if(this._updateNeededFrom=n,t===o)return this._innerDerivation.getValue();const e=this._fn(this._depDerivation.getValue());return e instanceof i.a?(this._innerDerivation=e,this._addDependency(e),e.getValue()):e}_recalculateCold(){const t=this._fn(this._depDerivation.getValue());return t instanceof i.a?t.getValue():t}_recalculate(){return this._hot?this._recalculateHot():this._recalculateCold()}_youMayNeedToUpdateYourself(t){const e=t===this._depDerivation?s:o;if(e===o&&t!==this._innerDerivation)throw Error("got a _youMayNeedToUpdateYourself() from neither the dep nor the inner derivation");this._updateNeededFrom===n?(this._updateNeededFrom=e,e===s&&this._removeInnerDerivation()):this._updateNeededFrom===s||e===s&&(this._updateNeededFrom=s,this._removeInnerDerivation()),i.a.prototype._youMayNeedToUpdateYourself.call(this,t)}_removeInnerDerivation(){this._innerDerivation&&(this._removeDependency(this._innerDerivation),this._innerDerivation=void 0)}_keepUptodate(){this._hot=!0,this._updateNeededFrom=s,this.getValue()}_stopKeepingUptodate(){this._hot=!1,this._updateNeededFrom=s,this._removeInnerDerivation()}}function c(t,e){return new a(t,e)}a.displayName="flatMap"},function(t,e,r){"use strict";r.r(e),r.d(e,"MapDerivation",(function(){return n})),r.d(e,"default",(function(){return s}));var i=r(0);class n extends i.a{constructor(t,e){super(),this._dep=t,this._fn=e,this._addDependency(t)}_recalculate(){return this._fn(this._dep.getValue())}}function s(t,e){return new n(t,e)}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,r){"use strict";r.r(e),r.d(e,"getProject",(function(){return Oe}));var i={};r.r(i),r.d(i,"CubicBezier",(function(){return gt}));var n={};r.r(n),r.d(n,"getTimelineTemplateState",(function(){return pe})),r.d(n,"getObjectState",(function(){return le})),r.d(n,"getPropState",(function(){return _e})),r.d(n,"getTimelineDuration",(function(){return fe}));var s={};r.r(s),r.d(s,"isBlah",(function(){return me}));var o={};r.r(o),r.d(o,"isReady",(function(){return ve})),r.d(o,"getDiskRevisionsBrowserStateIsBasedOn",(function(){return ge}));var a={};r.r(a),r.d(a,"getProject",(function(){return Oe}));var c=r(0),h=r(1);class u extends c.a{constructor(t,e){super(),this._root=t,this._path=e,this._untapFromChanges=h.a,this._cachedValue=void 0,this._hasCachedValue=!1}_recalculate(){return this._hot?(this._hasCachedValue||(this._cachedValue=this._root._getIdentityByPath(this._path),this._hasCachedValue=!0),this._cachedValue):this._root._getIdentityByPath(this._path)}_keepUptodate(){this._hot=!0,this._hasCachedValue=!1,this._cachedValue=void 0,this._untapFromChanges=this._root._tapIntoIdentityOfPathChanges(this._path,t=>{this._hasCachedValue=!0,this._cachedValue=t,this._youMayNeedToUpdateYourself(this)})}_stopKeepingUptodate(){this._untapFromChanges(),this._untapFromChanges=h.a,this._hot=!1,this._hasCachedValue=!1,this._cachedValue=void 0}}var d=Object.prototype.toString;var p=function(t){return d.call(t)};var l=function(t,e){return function(r){return t(e(r))}},_=l(Object.getPrototypeOf,Object);var f=function(t){return null!=t&&"object"==typeof t},m=Function.prototype,v=Object.prototype,g=m.toString,y=v.hasOwnProperty,b=g.call(Object);var T=function(t){if(!f(t)||"[object Object]"!=p(t))return!1;var e=_(t);if(null===e)return!0;var r=y.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&g.call(r)==b};var S=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};const w=(t,e,r)=>{if(0===e.length)return r(t);if(Array.isArray(t)){let[i,...n]=e;i=parseInt(String(i),10),isNaN(i)&&(i=0);const s=t[i],o=w(s,n,r);if(s===o)return t;const a=[...t];return a.splice(i,1,o),a}if("object"==typeof t&&null!==t){const[i,...n]=e,s=t[i],o=w(s,n,r);if(s===o)return t;return Object.assign({},t,{[i]:o})}{const[t,...i]=e;return{[t]:w(void 0,i,r)}}};var j=Array.isArray;var C=function(){return!1},O=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,D=/^\w*$/;var k=function(t,e){if(j(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!C(t))||(D.test(t)||!O.test(t)||null!=e&&t in Object(e))};var x=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,P=/\\(\\)?/g,N=function(t){return t}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(x,(function(t,r,i,n){e.push(i?n.replace(P,"$1"):r||t)})),e}));var I=function(t){return t};var V=function(t,e){return j(t)?t:k(t,e)?[t]:N(I(t))};var E=function(t){return t};var F=function(t,e){for(var r=0,i=(e=V(e,t)).length;null!=t&&r<i;)t=t[E(e[r++])];return r&&r==i?t:void 0};var M=function(t,e,r){var i=null==t?void 0:F(t,e);return void 0===i?r:i};const U={get(t,e){const r=t.$pointerMeta;if("$pointerMeta"===e)return r;if(r.cachedSubPointers[e])return r.cachedSubPointers[e];const i=B({root:r.root,path:[...r.path,e]});return r.cachedSubPointers[e]=i,i}},B=({root:t,path:e})=>new Proxy({$pointerMeta:{type:null,root:t,path:e,cachedSubPointers:{}}},U);var A,R=B;!function(t){t[t.Dict=0]="Dict",t[t.Array=1]="Array",t[t.Other=2]="Other"}(A||(A={}));const z=t=>Array.isArray(t)?A.Array:T(t)?A.Dict:A.Other,$=(t,e,r=z(t))=>r===A.Dict&&"string"==typeof e||r===A.Array&&Y(e)?t[e]:void 0,Y=t=>{const e="number"==typeof t?t:parseInt(t,10);return!isNaN(e)&&e>=0&&e<1/0&&(0|e)===e};class q{constructor(t,e){this._parent=t,this._path=e,this.children=new Map,this.identityChangeListeners=new Set}addIdentityChangeListener(t){this.identityChangeListeners.add(t)}removeIdentityChangeListener(t){this.identityChangeListeners.delete(t),this._checkForGC()}removeChild(t){this.children.delete(t),this._checkForGC()}getChild(t){return this.children.get(t)}getOrCreateChild(t){let e=this.children.get(t);return e||(e=e=new q(this,this._path.concat([t])),this.children.set(t,e)),e}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(S(this._path))}}class L{constructor(t){this.reduceState=(t,e)=>{const r=function(t,e,r){return 0===t.length?e(r):w(r,t,e)}(t,e,this.getState());return this.setState(r),r},this._currentState=t,this._rootThingy=new q(void 0,[]),this.pointer=R({root:this,path:[]})}setState(t){const e=this._currentState;this._currentState=t,this._comp([],this._rootThingy,e,t)}getState(){return this._currentState}getIn(t){return 0===t.length?this.getState():M(this.getState(),t)}_comp(t,e,r,i){if(r===i)return;if(e.identityChangeListeners.forEach(t=>t(i)),0===e.children.size)return;const n=z(r),s=z(i);n===A.Other&&n===s||e.children.forEach((e,o)=>{const a=$(r,o,n),c=$(i,o,s);this._comp([...t,o],e,a,c)})}getValueByPath(t){return M(this._currentState,t)}_getOrCreateThingyForPath(t){let e=this._rootThingy;for(const r of t)e=e.getOrCreateChild(r);return e}_getThingyForPath(t){let e=this._rootThingy;for(const r of t){const t=e.getChild(r);if(!t)return;e=t}return e}_getIdentityByPath(t){return 0===t.length?this._currentState:M(this._currentState,t)}_tapIntoIdentityOfPathChanges(t,e){const r=this._getOrCreateThingyForPath(t);r.identityChangeListeners.add(e);return()=>{r.identityChangeListeners.delete(e)}}}var W=t=>new L(t);const H=t=>{const e=t.$pointerMeta;let r=e.identityDerivation;return r||(r=e.identityDerivation=new u(e.root,e.path)),r},X=t=>G(t)?H(t).getValue():Object(c.b)(t)?t.getValue():t,G=t=>!(!t||!t.$pointerMeta);window.__theatrejsProjectsSingleton||(window.__theatrejsProjectsSingleton=new class{constructor(){this.atom=new L({projects:{}})}add(t,e){this.atom.reduceState(["projects",t],()=>e)}get(t){return this.atom.getState().projects[t]}has(t){return!!this.get(t)}});var K=window.__theatrejsProjectsSingleton;class J extends c.a{constructor(t){return super(),this._target=t,this._addDependency(t),this}setTarget(t){return t===this._target||(this._removeDependency(this._target),this._target=t,this._addDependency(this._target),this._youMayNeedToUpdateYourself(this)),this}_recalculate(){return this._target.getValue()}}class Q{constructor(t){this._value=t,this._mutableDerivation=new Z(this._value),this._publicDerivation=new J(this._mutableDerivation)}set(t){this._value=t,this._mutableDerivation.set(t)}get(){return this._value}get derivation(){return this._publicDerivation}}class Z extends c.a{constructor(t){super(),this._value=t}_recalculate(){return this._value}_keepUptodate(){}set(t){t!==this._value&&(this._value=t,this._youMayNeedToUpdateYourself(this))}_stopKeepingUptodate(){}}var tt=r(2);class et extends c.a{constructor(t){super(),this._fn=t}_recalculate(){let t;const e=new Set;return Object(tt.a)(()=>{t=this._fn()},t=>{e.add(t),this._addDependency(t)}),this._dependencies.forEach(t=>{e.has(t)||this._removeDependency(t)}),this._dependencies=e,t}_keepUptodate(){this.getValue()}}function rt(t){return new et(t)}const it=(t,e,r)=>t.adapters.findAdapterForNativeObject(e);class TheatreError extends Error{}class InvalidArgumentError extends TheatreError{}function nt(t,e){const r=t.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/," / ");return r}function st(){let t,e;const r=new Promise((r,i)=>{t=r,e=i});return{resolve:t,reject:e,promise:r}}function ot(t,e){return t.length<=e?t:t.substr(0,e-3)+"..."}var at=t=>"string"==typeof t?`string("${ot(t,10)}")`:"number"==typeof t?`number(${ot(String(t),10)})`:null===t?"null":void 0===t?"undefined":"boolean"==typeof t?String(t):Array.isArray(t)?"array":"object"==typeof t?"object":"unknown";class ct{constructor(t,e,r,i){this._ticker=t,this._decodedBuffer=e,this._audioContext=r,this._nodeDestination=i,this._state=W({time:0}),this._stopPlayCallback=h.a,this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=h.a}gotoTime(t){this._updateTimeInState(t)}_updateTimeInState(t){this._state.reduceState(["time"],()=>t)}getCurrentTime(){return this._state.getState().time}play(t,e,r,i){this.playing&&this.pause(),this.playing=!0;const n=this._ticker;let s=n.time;const o=e.to-e.from,a=this.getCurrentTime();if(1!==r)throw new InvalidArgumentError(`Audio-controlled timelines can only have a playbackRate of 1.0. ${r} given.`);if("normal"!==i)throw new InvalidArgumentError(`Audio-controlled timelines can only be played in the "normal" direction. '${i}' given.`);(a<e.from||a>e.to||a===e.to)&&this._updateTimeInState(e.from);let c=1;const h=st(),u=this._audioContext.createBufferSource();u.buffer=this._decodedBuffer,u.connect(this._mainGain);const d=this._audioContext.currentTime,p=(e.to-a)/1e3;t>1&&(u.loop=!0,u.loopStart=e.from/1e3,u.loopEnd=e.to/1e3),u.start(d+0,a/1e3-0,1===t?0+p:void 0);const l=i=>{const n=this.getCurrentTime();let a=(i-s)*r;if(s=i,a<0)return void f();const u=n+a;if(u<e.from){if(c===t)return this._updateTimeInState(e.from),this.playing=!1,_(),void h.resolve(!0);{c++;const t=(e.from-u)%o;return this._updateTimeInState(e.from+t),void f()}}if(u===e.to)return this._updateTimeInState(e.to),c===t?(this.playing=!1,_(),void h.resolve(!0)):void f();if(u>e.to){if(c===t)return this._updateTimeInState(e.to),this.playing=!1,_(),void h.resolve(!0);{c++;const t=(u-e.to)%o;return this._updateTimeInState(e.from+t),void f()}}return this._updateTimeInState(u),void f()},_=()=>{u.stop(),u.disconnect()};this._stopPlayCallback=()=>{_(),n.unregisterSideEffect(l),n.unregisterSideEffectForNextTick(l),this.playing&&h.resolve(!1)};const f=()=>n.registerSideEffectForNextTick(l);return n.registerSideEffect(l),h.promise}}var ht=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(r[i[n]]=t[i[n]])}return r};const ut=new WeakMap,dt=t=>ut.get(t);class pt{constructor(t){ut.set(this,t)}get time(){return dt(this).time}get duration(){return dt(this).getDurationCold()}get progress(){return this.time/this.duration}set progress(t){var e,r,i;const n=("number"!=typeof t||isNaN(t)?0:(i=1,(e=t)<(r=0)?r:e>i?i:e))*this.duration;this.time=n}set time(t){"number"==typeof t?t<0?console.error(`timeline.time = t must be a positive number. ${t} given.`):isNaN(t)?console.error("timeline.time = t must be a real number. NaN given."):dt(this).time=t:console.error(`timeline.time = t must be a number. ${at(t)} given.`)}get playing(){return dt(this).playing}getObject(t,e,r){const i=dt(this),n=nt(t),s=ht(r||{},[]),o=s?Object.assign({},s):{props:{}};let a=o;if(s&&s.hasOwnProperty("props"))0;else{const t=it(i._project,e);t?a=t.getConfig(e,o):a.props={}}const c=i._objects[n];if(c)return c.override(e,o,a),c.facade;return i.createObject(n,e,o,a).facade}play(t){if(dt(this)._project.isReady())return dt(this).play(t);{0;const t=st();return t.resolve(!0),t.promise}}pause(){dt(this).pause()}async experimental_attachAudio(t){const{audioContext:e,destinationNode:r,decodedBuffer:i}=await async function(t){const e=t.audioContext||new AudioContext,r=st();if(t.decodedBuffer)r.resolve(t.decodedBuffer);else{if("string"!=typeof t.source)throw new InvalidArgumentError("Error validating arguments to timeline.attachAudio(). You need to either provide a `decodedBuffer` or a `source`.");{let i,n;try{i=await fetch(t.source)}catch(e){throw console.error(e),new TheatreError(`Could not fetch '${t.source}'. Network error logged above.`)}try{n=await i.arrayBuffer()}catch(e){throw console.error(e),new TheatreError(`Could not read '${t.source}' as an arrayBuffer.`)}e.decodeAudioData(n,r.resolve,r.reject)}}let i;try{i=await r.promise}catch(e){throw console.error(e),new TheatreError(`Could not decode ${t.source} as an audio file.`)}return{destinationNode:t.destinationNode||e.destination,audioContext:e,decodedBuffer:i}}(t),n=dt(this),s=new ct(n._project.ticker,i,e,r);n.replacePlaybackController(s)}}class lt extends c.a{constructor(t){return super(),this._v=t,this}_recalculate(){return this._v}}function _t(t){return new lt(t)}var ft=r(7),mt=r.n(ft);class vt extends c.a{constructor(t,e){super(),this._deps=t,this._fn=e;for(const e in t)this._addDependency(t[e])}_recalculate(){return this._fn(this._deps)}}function gt(t){return bt(t)?Tt(t):_t(t.leftPointValue)}const yt=({timeD:t,leftPointTime:e,rightPointTime:r})=>{const i=r-e;return new vt({timeD:t},({timeD:t})=>"number"==typeof r?(t.getValue()-e)/i:0)},bt=({interpolationDescriptor:t})=>t.connected,Tt=t=>{const e=yt(t),r=(t=>{const e=t.handles[0],r=t.handles[1],i=t.handles[2],n=t.handles[3];return new mt.a(e,r,1-i,1-n)})(t.interpolationDescriptor),{leftPointValue:i,rightPointValue:n}=t;return rt(()=>{const t=r.solveSimple(e.getValue());return i+t*(n-i)})};const St=_t(0),wt=(t,e)=>{const r=t.getValue();if(0===e.length)return{started:!0,validFrom:-1/0,validTo:1/0,der:St};let i=0;for(;;){const n=e[i],s=i===e.length-1;if(!n)return jt.error;if(r<n.time)return 0===i?jt.beforeFirstPoint(n):jt.error;if(n.time===r)return s?jt.lastPoint(n):jt.between(n,e[i+1],t);if(i===e.length-1)return jt.lastPoint(n);{const s=i+1;if(e[s].time<=r){i=s;continue}return jt.between(n,e[i+1],t)}}},jt={beforeFirstPoint:t=>({started:!0,validFrom:-1/0,validTo:t.time,der:_t(t.value)}),lastPoint:t=>({started:!0,validFrom:t.time,validTo:1/0,der:_t(t.value)}),between(t,e,r){const n=t.interpolationDescriptor,s=n.interpolationType,o=i[s];let a;if(!o)throw new Error(`Unkown interpolationType '${s||"undefined"}'`);return a=o({timeD:r,interpolationDescriptor:n,leftPointTime:t.time,leftPointValue:t.value,rightPointTime:e.time,rightPointValue:e.value}),{started:!0,validFrom:t.time,validTo:e.time,der:a}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:St}};class Ct{constructor(t,e){this._timelnieInstanceObject=t,this.name=e;const r=H(this._timelnieInstanceObject._objectTemplate.atom.pointer.objectProps[e]),i=this._timelnieInstanceObject._objectTemplate._pointerToState.props[this.name].valueContainer,n=H(i.type);this._valueDerivation=r.flatMap(t=>t?n.flatMap(t=>{return t?"StaticValueContainer"===t?H(i.value).map(t=>"number"==typeof t?t:0):"BezierCurvesOfScalarValues"===t?(e=i.points,r=this._timelnieInstanceObject._timelineInstance.derivationToStatePointer.flatMap(t=>H(t.time)),H(e).flatMap(t=>{let e={started:!1};return rt(()=>{const i=r.getValue();return(!e.started||i<e.validFrom||e.validTo<=i)&&(e=wt(r,t)),e.der.getValue()})})):(console.error("@todo",t),0):0;var e,r}):0)}get value(){return this._valueDerivation.getValue()}}var Ot=function(t,e){return null==t?void 0:t[e]},Dt=function(){try{var t=Ot(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var kt=function(t,e,r){"__proto__"==e&&Dt?Dt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r};var xt=function(t){return function(e,r,i){for(var n=-1,s=Object(e),o=i(e),a=o.length;a--;){var c=o[t?a:++n];if(!1===r(s[c],c,s))break}return e}}(),Pt=l(Object.keys,Object);var Nt=function(t,e){return t&&xt(t,e,Pt)};var It=function(t){return t};var Vt=function(t,e){var r={};return e=It(e,3),Nt(t,(function(t,i,n){kt(r,i,e(t,i,n))})),r};const Et=new WeakMap,Ft=t=>Et.get(t);class TheatreObject{constructor(t){Et.set(this,t)}get name(){return Ft(this).path}get nativeObject(){return Ft(this).nativeObject}get currentValues(){return Ft(this).currentValues}onValuesChange(t){return Ft(this).onValuesChange(t)}}const Mt=_t(0).flatMap(()=>({}));class Ut{constructor(){this._requestedToStop=!1,this._stopRequestCallback=void 0,this._stopped=!1,this.controller=new Bt(this)}get requestedToStop(){return this._requestedToStop}stop(){this._requestedToStop||(this._requestedToStop=!0,this._stopRequestCallback&&this._stopRequestCallback())}onRequestStop(t){this._stopRequestCallback=t}setAsStopped(){this._stopped=!0}get stopped(){return this._stopped}}class Bt{constructor(t){this._task=t}stop(){this._task.stop()}get stopped(){return this._task.stopped}}class At{constructor(t,e,r,i,n){this._timelineInstance=t,this.path=e,this.nativeObject=r,this.config=i,this._propInstances={},this._shouldStartAdapter=!1,this._adapterStopFunction=void 0,this._adapterTaskController=void 0,this._project=t._project,this._objectTemplate=this._timelineInstance._timelineTemplate.getObjectTemplate(e,r,i,n),this._startAdapter(),this.facade=new TheatreObject(this),this._valuesD=Mt}_stopAdapter(){this._adapterTaskController&&(this._adapterTaskController.stop(),this._adapterTaskController=void 0)}_startAdapter(){const t=this._objectTemplate.adapter;if(t&&t.start){const e=new Ut;this._adapterTaskController=e.controller,this._project.ready.then(()=>{if(e.requestedToStop)return void e.setAsStopped();const r=t.start(this.facade);e.onRequestStop(()=>{"function"==typeof r&&r(),e.setAsStopped()})})}}override(t,e,r){this._stopAdapter();this._objectTemplate.override(t,e,r),this._startAdapter()}getProp(t){return this._propInstances[t]||(this._propInstances[t]=new Ct(this,t)),this._propInstances[t]}_getValuesDerivation(){return this._valuesD===Mt&&(this._valuesD=rt(()=>{const t=X(this._objectTemplate.atom.pointer.objectProps);return Vt(t,(t,e)=>this.getProp(e))}).flatMap(t=>rt(()=>Vt(t,t=>t.value)))),this._valuesD}onValuesChange(t){const e=this._getValuesDerivation();let r;const i=e.changes(this._objectTemplate._project.ticker).tap(e=>{r&&Rt(r,e)||(r=e,t(e,this._timelineInstance.time))});return this._project.ticker.registerSideEffect(()=>{const i=e.getValue();r=i,t(i,this._timelineInstance.time)}),i}get currentValues(){let t;return this._getValuesDerivation().tapImmediate(this._project.ticker,e=>t=e)(),t}}const Rt=(t,e)=>{const r=Object.keys(t);for(const i of r)if(t[i]!==e[i])return!1;const i=Object.keys(e);if(r.length!==i.length)return!1;for(const r of i)if(t[r]!==e[r])return!1;return!0};class zt{constructor(t){this._ticker=t,this.playing=!1,this._stopPlayCallback=h.a,this._state=W({time:0}),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=h.a}gotoTime(t){this._updateTimeInState(t)}_updateTimeInState(t){this._state.reduceState(["time"],()=>t)}getCurrentTime(){return this._state.getState().time}play(t,e,r,i){this.playing&&this.pause(),this.playing=!0;const n=this._ticker;let s=n.time;const o=e.to-e.from,a=this.getCurrentTime();a<e.from||a>e.to?this._updateTimeInState(e.from):a!==e.to||"normal"!==i&&"alternate"!==i?a!==e.from||"reverse"!==i&&"alternateReverse"!==i||this._updateTimeInState(e.to):this._updateTimeInState(e.from);let c="alternateReverse"===i||"reverse"===i?-1:1,h=1;const u=st(),d=n=>{const a=this.getCurrentTime();let d=r*c*(n-s);if(s=n,d<0)return void p();const l=a+d;if(l<e.from){if(h===t)return this._updateTimeInState(e.from),this.playing=!1,void u.resolve(!0);{h++;const t=(e.from-l)%o;return"reverse"===i?this._updateTimeInState(e.to-t):(c=1,this._updateTimeInState(e.from+t)),void p()}}if(l===e.to)return this._updateTimeInState(e.to),h===t?(this.playing=!1,void u.resolve(!0)):void p();if(l>e.to){if(h===t)return this._updateTimeInState(e.to),this.playing=!1,void u.resolve(!0);{h++;const t=(l-e.to)%o;return"normal"===i?this._updateTimeInState(e.from+t):(c=-1,this._updateTimeInState(e.to-t)),void p()}}return this._updateTimeInState(l),void p()};this._stopPlayCallback=()=>{n.unregisterSideEffect(d),n.unregisterSideEffectForNextTick(d),this.playing&&u.resolve(!1)};const p=()=>n.registerSideEffectForNextTick(d);return n.registerSideEffect(d),u.promise}}class $t{constructor(t,e,r,i){var n;this._project=t,this._path=e,this._instanceId=r,this._objects={},this._playbackControllerBox=(n=i||new zt(this._project.ticker),new Q(n)),this._timelineTemplate=t._getTimelineTemplate(e),this._address=Object.assign({},this._timelineTemplate._address,{timelineInstanceId:r}),this.facade=new pt(this),this._statePointerDerivation=this._playbackControllerBox.derivation.map(t=>t.statePointer),this._timeDerivation=this._statePointerDerivation.flatMap(t=>H(t.time))}get derivationToStatePointer(){return this._statePointerDerivation}get timeDerivation(){return this._timeDerivation}createObject(t,e,r,i){return this._objects[t]=new At(this,t,e,r,i)}getObject(t){return this._objects[t]}get time(){return this._playbackControllerBox.get().getCurrentTime()}set time(t){let e=t;this.pause(),e>this._timelineTemplate.duration&&(e=this._timelineTemplate.duration);const r=this._timelineTemplate.duration;this._playbackControllerBox.get().gotoTime(e>r?r:e)}getDurationCold(){return this._timelineTemplate._durationD.getValueCold()}get playing(){return this._playbackControllerBox.get().playing}_makeRangeFromTimelineTemplate(){return rt(()=>({from:0,to:X(this._timelineTemplate._durationD)}))}play(t){const e=this._timelineTemplate.duration,r=t&&t.range?t.range:{from:0,to:e};const i=t&&"number"==typeof t.iterationCount?t.iterationCount:1;const n=t&&void 0!==t.rate?t.rate:1;const s=t&&t.direction?t.direction:"normal";return this._play(i,{from:r.from,to:r.to},n,s)}_play(t,e,r,i){return this._playbackControllerBox.get().play(t,e,r,i)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(t){this.pause();const e=this._playbackControllerBox.get();this._playbackControllerBox.set(t);const r=e.getCurrentTime();e.destroy(),t.gotoTime(r)}}class Yt{constructor(t,e,r,i,n){this.timelineTemplate=t,this.path=e,this._address=Object.assign({},t._address,{objectPath:e}),this.atom=W({objectProps:n.props}),this.adapter=it(this.timelineTemplate.project,r)}get _project(){return this.timelineTemplate.project}get _pointerToState(){return this.timelineTemplate._pointerToState.objects[this.path]}override(t,e,r){this.adapter=it(this.timelineTemplate.project,t),this.atom.reduceState(["objectProps"],()=>r.props)}ensureNativeObjectIsAcceptable(t,e){}}class qt{constructor(t,e){this.project=t,this._path=e,this._objectTemplates=new L({}),this._durationD=rt(()=>X(this.project._selectors.historic.getTimelineDuration(this.project.atomP.historic,this.address))),this._address=Object.assign({},this.project._address,{timelinePath:e}),this._playableRangeD=void 0}get _pointerToState(){return this.project.atomP.historic.timelineTemplates[this._path]}getObjectTemplate(t,e,r,i){let n=this._objectTemplates.getState()[t];return n?n.ensureNativeObjectIsAcceptable(e,r):(n=new Yt(this,t,e,r,i),this._objectTemplates.reduceState([t],()=>n)),n}_getPlayableRangeD(){if(this._playableRangeD)return this._playableRangeD;const t=new lt(0),e=this._durationD;return this._playableRangeD=rt(()=>({start:t.getValue(),end:e.getValue()}))}get duration(){return this._durationD.getValue()}get address(){return this._address}}var Lt=Math.ceil,Wt=Math.max;var Ht=function(t,e,r,i){for(var n=-1,s=Wt(Lt((e-t)/(r||1)),0),o=Array(s);s--;)o[i?s:++n]=t,t+=r;return o};var Xt=function(){return!1};var Gt=function(t){return t};var Kt=function(t){return function(e,r,i){return i&&"number"!=typeof i&&Xt(e,r,i)&&(r=i=void 0),e=Gt(e),void 0===r?(r=e,e=0):r=Gt(r),i=void 0===i?e<r?1:-1:Gt(i),Ht(e,r,i,t)}}();var Jt=function(t,e,r,i){for(var n=-1,s=null==t?0:t.length;++n<s;){var o=t[n];e(i,o,r(o),t)}return i};var Qt=function(t,e,r,i){for(var n=-1,s=null==t?0:t.length;++n<s;){var o=t[n];e(i,o,r(o),t)}return i};var Zt=function(t,e){return function(r,i){var n=j(r)?Jt:Qt,s=e?e():{};return n(r,t,It(i,2),s)}}((function(t,e,r){kt(t,r,e)}));const te=new WeakMap;class TheatreAdaptersManager{constructor(t){te.set(this,t)}add(t,e=5){const r=(i=this,te.get(i));var i;r._adaptersByPriority[e];const n=t;r.add(n,e)}}const ee=Kt(1,11);class re{constructor(t){this.project=t,this._adaptersByPriority=Vt(Zt(ee,t=>t),()=>new Set),this._adaptersByName=new Map,this.facade=new TheatreAdaptersManager(this)}add(t,e=5){this._adaptersByPriority[e].add(t),this._adaptersByName.set(t.name,t)}getAdapterByName(t){return this._adaptersByName.get(t)}findAdapterForNativeObject(t){for(const e of ee){const r=this._adaptersByPriority[e];for(const e of r){const r=e.canHandle(t);if("boolean"==typeof r){if(!0===r)return e}else 0}}}}var ie=r(5);class ne{constructor(){this._computationsToUpdate=new Set,this._objectsWhoseStructureShouldBeUpdated=new Set,this._sideEffectsToCall=new Set,this._sideEffectsToCallOnNextTick=new Set,this._tickingT=0}registerComputationUpdate(t){this._computationsToUpdate.has(t)||this._computationsToUpdate.add(t)}addObjectWhoseStructureShouldBeUpdated(t){this._objectsWhoseStructureShouldBeUpdated.add(t)}registerSideEffect(t){this._sideEffectsToCall.add(t)}registerSideEffectForNextTick(t){this._sideEffectsToCallOnNextTick.add(t)}unregisterSideEffect(t){this._sideEffectsToCall.delete(t)}unregisterSideEffectForNextTick(t){this._sideEffectsToCallOnNextTick.delete(t)}get time(){return this.ticking?this._tickingT:performance.now()}tick(t=performance.now()){this.ticking=!0,this._tickingT=t,this._sideEffectsToCallOnNextTick.forEach(t=>this._sideEffectsToCall.add(t)),this._sideEffectsToCallOnNextTick.clear(),this._tick(0),this.ticking=!1}_tick(t){const e=this.time;if(t>10&&console.warn("tick() recursing for 10 times"),t>100)throw new Error("Maximum recursion limit for tick()");const r=this._objectsWhoseStructureShouldBeUpdated;if(this._objectsWhoseStructureShouldBeUpdated=new Set,r.forEach(t=>{t._updateStructure()}),this._objectsWhoseStructureShouldBeUpdated.size>0)return this._tick(t+1);const i=this._computationsToUpdate;this._computationsToUpdate=new Set,i.forEach(t=>{t._updateComputation()});const n=this._sideEffectsToCall;return this._sideEffectsToCall=new Set,n.forEach(t=>{t(e)}),this._objectsWhoseStructureShouldBeUpdated.size>0||this._computationsToUpdate.size>0||this._sideEffectsToCall.size>0?this._tick(t+1):void 0}}var se=r(4),oe="@@redux/INIT";function ae(t,e,r){var i;if("function"==typeof e&&void 0===r&&(r=e,e=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(ae)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var n=t,s=e,o=[],a=o,c=!1;function h(){a===o&&(a=o.slice())}function u(){return s}function d(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return h(),a.push(t),function(){if(e){e=!1,h();var r=a.indexOf(t);a.splice(r,1)}}}function p(t){if(!T(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,s=n(s,t)}finally{c=!1}for(var e=o=a,r=0;r<e.length;r++){(0,e[r])()}return t}return p({type:oe}),(i={dispatch:p,subscribe:d,getState:u,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");n=t,p({type:oe})}})[se.a]=function(){var t,e=d;return(t={subscribe:function(t){if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");function r(){t.next&&t.next(u())}return r(),{unsubscribe:e(r)}}})[se.a]=function(){return this},t},i}function ce(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}var he=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};function ue(t){const e=[];e.unshift(function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return function(r,i,n){var s,o=t(r,i,n),a=o.dispatch,c={getState:o.getState,dispatch:function(t){return a(t)}};return s=e.map((function(t){return t(c)})),a=ce.apply(void 0,s)(o.dispatch),he({},o,{dispatch:a})}}}());const r=ce(...e);return ae(t.rootReducer,void 0,r)}var de=t=>t;const pe=de((t,e)=>t.timelineTemplates[e.timelinePath]),le=de((t,e)=>{const r=pe(t,e);return r&&r.objects[e.objectPath]}),_e=de((t,e)=>{const r=le(t,e);return r&&r.props[e.propKey]}),fe=de((t,e)=>{const r=X(t.timelineTemplates[e.timelinePath].duration);return"number"==typeof r?r:2e3}),me=de(t=>!0),ve=de(t=>"loaded"===X(t.loadingState.type)),ge=de(t=>t.loadingState.diskRevisionsThatBrowserStateIsBasedOn);var ye={historic:n,ahistoric:s,ephemeral:o};var be=new Promise(t=>t());class Te{constructor(t,e={},r){this.id=t,this.config=e,this.facade=r,this._timelineInstances=new L({}),this._timelineTemplates=new L({}),this._enabled=!1,this._actions=ie.projectActions,this._selectors=ye,this._isReady=!1,K.add(t,this),this.adapters=new re(this);{const e=this.config.state,r=(i=e.projectState,n=e.revision,{ahistoric:{},historic:Object.assign({},i,{"@@history":{commitsByHash:{},currentCommitHash:void 0,innerState:Object.assign({},i),listOfCommitHashes:[]},"@@tempActions":[]}),ephemeral:{loadingState:{type:"loaded",diskRevisionsThatBrowserStateIsBasedOn:[n]},lastExportedObject:null}});this.reduxStore=ue({devtoolsOptions:{name:"Theatre.js Project "+t},rootReducer:(t=r)=>t}),this._isReady=!0,this._readyPromise=be}var i,n;this.atom=function(t){let e=t.getState();const r=W(e);return t.subscribe(()=>{const i=t.getState();r.setState(i),e=i}),r}(this.reduxStore),this.atomP=this.atom.pointer,this.ticker=new ne,this._address={projectId:this.id};const s=t=>{this.ticker.tick(t),window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}getTimeline(t,e="default"){let r=this._timelineInstances.getIn([t,e]);return r||(r=new $t(this,t,e),this._timelineInstances.reduceState([t],(t={})=>Object.assign({},t,{[e]:r}))),r}_getTimelineTemplate(t){let e=this._timelineTemplates.getState()[t];return e||(e=new qt(this,t),this._timelineTemplates.reduceState([t],()=>e)),e}_dispatch(...t){return this.reduxStore.dispatch(this._actions.batched(t))}get ready(){return this._readyPromise}isReady(){return this._isReady}}Te.version="0.2.3";const Se=new WeakMap;class we{constructor(t,e={}){Se.set(this,new Te(t,e,this))}getTimeline(t,e="default"){const r=nt(t);return je(this).getTimeline(r,e).facade}get adapters(){return je(this).adapters.facade}get ready(){return je(this).ready}get isReady(){return je(this).isReady()}}const je=t=>Se.get(t);r(8),r(9);var Ce=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(r[i[n]]=t[i[n]])}return r};function Oe(t,e={}){const r=Ce(e,[]);if(K.has(t))return K.get(t).facade;if(!e.state)throw new InvalidArgumentError(`Argument config.state in Theatre.getProject("${t}", config) cannot be empty in theatre/core. Read more at https://docs.theatrejs.com/`);return De(t,e.state),new we(t,r)}const De=(t,e)=>{if(Array.isArray(e)||null==e||"0.2.0"!==e.definitionVersion)throw new InvalidArgumentError(`Error validating conf.state in Theatre.getProject(${JSON.stringify(t)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`)};e.default=a}])}));